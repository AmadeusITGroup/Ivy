!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function e(e,t,n,r){var i,o=arguments.length,c=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(o<3?i(c):o>3?i(t,n,c):i(t,n))||c);return o>3&&c&&Object.defineProperty(t,n,c),c}function t(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var n="ΔTrackable",r="ΔChangeVersion",i="ΔDefFactories",o="ΔΔProxy",c="ΔIsProxy",a=!1;function u(e){return e&&e.ΔTrackable?e.ΔMd?e.ΔMd:e.ΔMd={parents:void 0,refreshCtxt:void 0,watchers:void 0}:null}var s=Array.isArray;function f(e,t){e&&(s(e)&&!e[c]?e.forEach(t):t(e))}function d(e,t){if(e&&t){if(e===t)return;if(s(e)){var n=e;if(1===n.length){if(n[0]===t)return}else{var r=n.indexOf(t);if(r>-1)return n.splice(r,1),1===n.length?n[0]:n}}}return e}function l(e,t){return e?s(e)&&!e[c]?(e.push(t),e):[e,t]:t}function v(e){return e&&!0===e[n]?e[r]:0}function h(e){return!(!e||!0!==e[n])}function p(e){return v(e)%2==1}function g(e){var t,n=e.ΔMd;return n&&(t=n.watchers)?s(t)&&!t[c]?t.length:1:0}function m(e){var t=e.prototype;t[n]=!0,t[r]=0}function y(e,t){return e||(e=x,t=3),function(n,r){var c="ΔΔ"+r,u=n[i];u||(u=n[i]={}),u[r]=t?1===t?x:M:e,n[c]=void 0,function(e,t,n,r){r&&delete e[t]&&Object.defineProperty(e,t,r)}(n,r,0,{get:function(){return function(e,t,n,r,i){e.ΔComputeDependencies&&(e.ΔComputeDependencies[n]=!0);var o=e[t];(void 0===o||a&&null===o)&&(o=e[t]=!a&&i?i>1?void 0:null:r(),E(e,o));return o}(this,c,r,e,t)},set:function(t){!function(e,t,n,r,i,c){var a=h(r);if(e.ΔComputeDependencies)return void console.error("[Trax] @computed properties must not mutate the Data object when calculated");r&&!a&&i.ΔCreateProxy&&(r=i.ΔCreateProxy(r)||r,a=h(r));var u=!1,s=c[n];p(e)?u=s!==r:s!==r&&(!function e(t){if(!h(t))return;var n=!0;p(t)?n=!1:t.ΔChangeVersion+=1;if(k.register(t),n){var r=t.ΔMd;r&&r.parents&&f(r.parents,(function(t){e(t)}))}}(e),u=!0);u&&(a&&void 0===r&&(r=null),(a||s&&h(s))&&function(e,t,n){(function(e,t){if(t){var n=t.ΔMd;n&&n.parents&&(n.parents=d(n.parents,e))}})(e,t),E(e,n)}(e,s,r),c[n]=r,function(e,t,n,r,i){var c=e?e.ΔMd:void 0;if(c&&c.trackers){var a=e[o]||e;f(c.trackers,(function(e){e(a,t,n,r,i)}))}}(e,"set",t,s,r))}(this,r,c,t,e,this)},enumerable:!0,configurable:!0})}}function b(){return""}b["ΔIsFactory"]=!0;var w=b;function j(){return 0}j["ΔIsFactory"]=!0;var C=j;function x(){return null}function M(){}function E(e,t){if(t){var n=u(t);n&&(n.parents=l(n.parents,e))}}x["ΔIsFactory"]=!0,M["ΔIsFactory"]=!0;var I=0,N=function(){function e(){this.id=++I}return e.prototype.register=function(e){var t=this,n=u(e);n&&!n.refreshCtxt&&(this.objects?this.objects.push(e):(this.objects=[e],Promise.resolve().then((function(){t.refresh()}))),n.refreshCtxt=this)},e.prototype.refresh=function(e){void 0===e&&(e=!0);var t=this.objects,n=t?t.length:0;if(n){B();for(var r,i,o=[],c=0;n>c;c++)(i=(r=t[c]).ΔMd).refreshCtxt&&(r.ΔChangeVersion%2&&(r.ΔChangeVersion+=1),i.refreshCtxt&&i.watchers&&o.push({dataNode:r,watchers:i.watchers})),i.refreshCtxt=void 0;this.objects=void 0,o.length&&(e?P(o):Promise.resolve().then((function(){P(o)})))}},e}();function P(e){for(var t=function(e){f(e.watchers,(function(t){t(e.dataNode)}))},n=0,r=e;n<r.length;n++){t(r[n])}}var k=new N;function B(){k.objects&&(k=new N)}var D=new(function(){function n(){}return e([y(w),t("design:type",String)],n.prototype,"firstName",void 0),e([y(w),t("design:type",String)],n.prototype,"lastName",void 0),e([y(C),t("design:type",Number)],n.prototype,"id",void 0),n=e([m],n)}());D.firstName="Marge",D.lastName="Simpson",D.id=1,O("init complete (watch not activated)"),T();var L=0;document.getElementById("update").addEventListener("click",(function(){D.firstName+="+"+ ++L,D.id++}));var R,F=null;function O(e){(R=R||[]).push(e),document.getElementById("logs").innerHTML=["<b>logs:</b> <br/>",R.join("<br/>")].join("")}function T(){document.getElementById("data").innerHTML=['<div class="user"> <b>user:</b> ',D.firstName," / ",D.lastName," / ",D.id,"</div>"].join("")}document.getElementById("watch").addEventListener("click",(function(){var e,t,n;0===g(D)?(t=function(){O("user changed - version: "+v(D)),T()},n=u(e=D),F=n&&t?(n.watchers=l(n.watchers,t),p(e)&&k.register(e),t):null,O("watch <b>activated</b>")):O("watch <b>already activated</b>")})),document.getElementById("unwatch").addEventListener("click",(function(){var e,t,n;t=F,(n=(e=D)?e.ΔMd:void 0)&&t&&(n.watchers=d(n.watchers,t)),O("watch <b>deactivated</b>")})),document.getElementById("reload").addEventListener("click",(function(){location.reload()}))}();
