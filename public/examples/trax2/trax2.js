!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function t(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function e(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var n="ΔTrackable",r="ΔChangeVersion",i="ΔFactory",o="ΔDefFactories",a="ΔIsFactory",s="ΔΔProxy",c="ΔIsProxy",u="ΔCreateProxy",f=!1;function d(t){return t&&t.ΔTrackable?t.ΔMd?t.ΔMd:t.ΔMd={parents:void 0,refreshCtxt:void 0,watchers:void 0}:null}var l=Array.isArray;function h(t,e){t&&(l(t)&&!t[c]?t.forEach(e):e(t))}function v(t,e){if(t&&e){if(t===e)return;if(l(t)){var n=t;if(1===n.length){if(n[0]===e)return}else{var r=n.indexOf(e);if(r>-1)return n.splice(r,1),1===n.length?n[0]:n}}}return t}function p(t,e){return t?l(t)&&!t[c]?(t.push(e),t):[t,e]:e}function m(t){return t&&!0===t[n]?t[r]:0}function y(t){return!(!t||!0!==t[n])}function g(t){return m(t)%2==1}function b(t){var e,n=t.ΔMd;return n&&(e=n.watchers)?l(e)&&!e[c]?e.length:1:0}function w(t){var e=t.prototype;e[n]=!0,e[r]=0}function L(t,e){return t||(t=j,e=3),function(n,r){var i="ΔΔ"+r,a=n[o];a||(a=n[o]={}),a[r]=e?1===e?j:S:t,n[i]=void 0,function(t,e,n,r){r&&delete t[e]&&Object.defineProperty(t,e,r)}(n,r,0,{get:function(){return function(t,e,n,r,i){t.ΔComputeDependencies&&(t.ΔComputeDependencies[n]=!0);var o=t[e];(void 0===o||f&&null===o)&&(o=t[e]=!f&&i?i>1?void 0:null:r(),F(t,o));return o}(this,i,r,t,e)},set:function(e){k(this,r,i,e,t,this)},enumerable:!0,configurable:!0})}}function x(t){var e=t.ΔFactory;if(e)return e;function n(e){return new t}return n[a]=!0,t[i]=n,n}function E(){return""}E[a]=!0;var I=E;function N(){return 0}N[a]=!0;var C=N;function j(){return null}j[a]=!0;var P=j;function S(){}function k(t,e,n,r,i,o){var a=y(r);if(t.ΔComputeDependencies)console.error("[Trax] @computed properties must not mutate the Data object when calculated");else{r&&!a&&i.ΔCreateProxy&&(a=y(r=i.ΔCreateProxy(r)||r));var s=!1,c=o[n];g(t)?s=c!==r:c!==r&&(B(t),s=!0),s&&(a&&void 0===r&&(r=null),(a||c&&y(c))&&function(t,e,n){T(t,e),F(t,n)}(t,c,r),o[n]=r,M(t,"set",e,c,r))}}function M(t,e,n,r,i){var o=t?t.ΔMd:void 0;if(o&&o.trackers){var a=t[s]||t;h(o.trackers,(function(t){t(a,e,n,r,i)}))}}function B(t){if(y(t)){var e=!0;if(g(t)?e=!1:t.ΔChangeVersion+=1,R.register(t),e){var n=t.ΔMd;n&&n.parents&&h(n.parents,(function(t){B(t)}))}}}function T(t,e){if(e){var n=e.ΔMd;n&&n.parents&&(n.parents=v(n.parents,t))}}function F(t,e){if(e){var n=d(e);n&&(n.parents=p(n.parents,t))}}S[a]=!0;var O=0,D=function(){function t(){this.id=++O}return t.prototype.register=function(t){var e=this,n=d(t);n&&!n.refreshCtxt&&(this.objects?this.objects.push(t):(this.objects=[t],Promise.resolve().then((function(){e.refresh()}))),n.refreshCtxt=this)},t.prototype.refresh=function(t){void 0===t&&(t=!0);var e=this.objects,n=e?e.length:0;if(n){A();for(var r,i,o=[],a=0;n>a;a++)(i=(r=e[a]).ΔMd).refreshCtxt&&(r.ΔChangeVersion%2&&(r.ΔChangeVersion+=1),i.refreshCtxt&&i.watchers&&o.push({dataNode:r,watchers:i.watchers})),i.refreshCtxt=void 0;this.objects=void 0,o.length&&(t?V(o):Promise.resolve().then((function(){V(o)})))}},t}();function V(t){for(var e=function(t){h(t.watchers,(function(e){e(t.dataNode)}))},n=0,r=t;n<r.length;n++){e(r[n])}}var R=new D;function A(){R.objects&&(R=new D)}var H=["push","pop","shift","unshift","splice"],$=/^\d+$/,J=/^\Δ/,_=function(){function t(t){this.ΔTrackable=!0,this.ΔDataFactory=!0,this.ΔChangeVersion=0,this.ΔMd=void 0,this.ΔΔSelf=this,this.ΔIsProxy=!1,this.ΔItemFactory=t}return t.ΔNewProxy=function(e){var n=new Proxy([],new t(e));return n[s]=n,n},t.ΔCreateProxy=function(e,n){if(l(e)){var r=new Proxy(e,new t(n)),i=e.length;for(B(r);i--;)F(r,e[i]);return r}return null},t.prototype.$newItem=function(t){var e=this.ΔItemFactory();return void 0===t&&(t=this.ΔΔList.length),t>-1&&k(this.ΔΔSelf,t,t,e,this.ΔItemFactory,this.ΔΔList),e},t.prototype.$dispose=function(){for(var t=this.ΔΔList,e=t.length;e--;)T(this.ΔΔSelf,t[e]);return t},t.prototype.ΔToString=function(){return"Trax List ["+this.ΔΔList.join(", ")+"]"},t.prototype.set=function(t,e,n){if(this.ΔΔList||(this.ΔΔList=t),e.match($)){var r=parseInt(e,10);k(this.ΔΔSelf,r,r,n,this.ΔItemFactory,this.ΔΔList)}else e.match(J)&&(this[e]=n);return!0},t.prototype.get=function(t,e){if(this.ΔΔList||(this.ΔΔList=t),e===c)return!0;if("string"===typeof e){if(e.match(J))return this[e];if(e.match($))return this.ΔΔList[parseInt(e,10)];if("length"===e)return this.ΔΔList.length;if("push"===e)return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=this,i=e.length,o=r.ΔΔList.length,a=0;i>a;a++)r.set(t,o+a+"",e[a])};if("toString"===e)return this.ΔToString;if("function"==typeof t[e])return function(){var t=this,n=H.indexOf(e)>-1;if(n){B(t);for(var r=t.ΔΔList,i=0;r.length>i;i++)T(t,r[i])}var o=t.ΔΔList,a=o[e].apply(o,arguments);if(n){for(r=t.ΔΔList,i=0;r.length>i;i++)F(t,r[i]);M(this,e)}return a}}return e===Symbol.iterator?this.ΔΔList[Symbol.iterator]:this[e]},t}();var q=function(t){function e(){return _.ΔNewProxy(t)}return t=t||P,e[a]=!0,e[u]=function(e){return _.ΔCreateProxy(e,t)},e},z=function(){function n(){}return t([L(I),e("design:type",String)],n.prototype,"firstName",void 0),t([L(I),e("design:type",String)],n.prototype,"lastName",void 0),t([L(C),e("design:type",Number)],n.prototype,"id",void 0),n=t([w],n)}(),G=function(){function n(){}return t([L(x(z)),e("design:type",z)],n.prototype,"leader",void 0),t([L(I),e("design:type",String)],n.prototype,"name",void 0),t([L(q(x(z))),e("design:type",Array)],n.prototype,"members",void 0),t([L(),e("design:type",Object)],n.prototype,"data",void 0),n=t([w],n)}(),K=new z;K.firstName="Marge",K.lastName="Simpson",K.id=1;var Q=new z;Q.firstName="Homer",Q.lastName="Simpson",Q.id=1;var U=new G;U.name="The Simpsons",U.leader=K,U.members[0]=K,U.members.push(Q),U.data={value1:"v1",value2:"v2"},Z("init complete (watch not activated)"),tt();var W=0;document.getElementById("update1").addEventListener("click",(function(){K.firstName+="+"+ ++W})),document.getElementById("update2").addEventListener("click",(function(){Q.firstName+="+"+ ++W,Q.lastName+="+"+W})),document.getElementById("update3").addEventListener("click",(function(){U.data.value1+="+"+ ++W})),document.getElementById("add").addEventListener("click",(function(){var t=new z;t.firstName="Bart"+ ++W,t.lastName="Simpson",t.id=W,U.members.push(t)})),document.getElementById("remove").addEventListener("click",(function(){U.members.splice(0,1)})),document.getElementById("new_data").addEventListener("click",(function(){U.data={value1:"VAL1-"+ ++W,value2:"VAL2-"+W}})),document.getElementById("reload").addEventListener("click",(function(){location.reload()}));var X,Y=null;function Z(t){(X=X||[]).push(t),document.getElementById("logs").innerHTML=["<b>logs:</b> <br/>",X.join("<br/>")].join("")}function tt(){document.getElementById("data").innerHTML=['<div class="group">',"<div><b>name:</b> ",U.name,"</div>","<div><b>leader:</b> ",U.leader.firstName," / ",U.leader.lastName,"</div>","<div><b>number of members:</b> ",U.members.length,"</div>","<div><b>members:</b></div>",U.members.map((function(t,e){return'\n            <div class="member"> \n            '+(e+1)+". "+t.firstName+" / "+t.lastName+"\n            </div>"})).join(""),"<div><b>data:</b> ",JSON.stringify(U.data),"</div>","</div>"].join("")}document.getElementById("watch").addEventListener("click",(function(){var t,e,n;0===b(U)?(e=function(){Z("group changed - versions: \n                g="+m(U)+" \n                user1="+m(K)+" \n                user2="+m(Q)),tt()},n=d(t=U),Y=n&&e?(n.watchers=p(n.watchers,e),g(t)&&R.register(t),e):null,Z("group watch <b>activated</b>")):Z("group watch <b>already activated</b>")})),document.getElementById("unwatch").addEventListener("click",(function(){var t,e,n;e=Y,(n=(t=U)?t.ΔMd:void 0)&&e&&(n.watchers=v(n.watchers,e)),Z("group watch <b>deactivated</b>")}))}();
